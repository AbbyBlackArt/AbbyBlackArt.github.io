---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import Link from "@components/Link.astro";

type Props = {
  works: CollectionEntry<"works">[];
  basePath?: string; // Optional base path for work links, defaults to "/works"
};

const { works, basePath = "/works" } = Astro.props;

---

{works?.length === 0 ? (
  <p class="text-center text-black/50 dark:text-white/50">No works to display.</p>
) : (
  <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 font-serif" role="list">
    {works?.map((work) => {
      if (!work.data.images || work.data.images?.length === 0) return null;
      return (
        <li class="flex flex-col">
          <Link href={`${basePath}/${work.slug}`} underline={false}>
            <figure class="relative w-full aspect-[4/3] overflow-hidden bg-gray-100 dark:bg-stone-800">
              <Image
                src={work.data.images[0].file}
                alt={work.data.title}
                class="w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-90"
                loading="lazy"
                width={800}
                height={600}
              />
              <figcaption class="absolute bottom-0 left-0 right-0 bg-black/60 dark:bg-black/80 text-white p-2 text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <div class="font-semibold truncate">{work.data.title}</div>
                {work.data.summary && (
                  <div class="text-xs opacity-90 truncate">{work.data.summary}</div>
                )}
              </figcaption>
            </figure>
          </Link>
          <div class="mt-2 text-center">
            <p class="text-sm text-black dark:text-white font-medium truncate">
              {work.data.title}
            </p>
            {work.data.summary && (
              <p class="text-xs text-black/60 dark:text-white/60 truncate">
                {work.data.summary}
              </p>
            )}
          </div>
        </li>
      );
    })}
  </ul>
)}
