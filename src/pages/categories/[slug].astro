---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import { Image } from "astro:assets";
import Link from "@components/Link.astro";

export async function getStaticPaths() {
  const images = await getCollection("images");
  
  // Get all unique categories from all images
  const allCategories = new Set<string>();
  images.forEach((image) => {
    if (image.data.categories) {
      image.data.categories.forEach((category) => {
        allCategories.add(category);
      });
    }
  });
  
  // Generate paths for each category
  return Array.from(allCategories).map((category) => ({
    params: { slug: category.toLowerCase().replace(/\s+/g, "-") },
    props: { category },
  }));
}

type Props = {
  category: string;
};

const { category } = Astro.props;

// Get all images that have this category
const images = (await getCollection("images")).filter((image) => {
  if (!image.data.categories) return false;
  return image.data.categories.some(
    (cat) => cat.toLowerCase().replace(/\s+/g, "-") === category.toLowerCase().replace(/\s+/g, "-")
  );
});

// Format category name for display (convert slug back to readable format)
const categoryDisplayName = category
  .split("-")
  .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
  .join(" ");
---

<PageLayout title={categoryDisplayName} description={`Images in the ${categoryDisplayName} category`}>
  <Container>
    <div class="animate">
      <Link href="/">‚Üê Back to home</Link>
    </div>
    <h1 class="animate text-2xl font-semibold text-black dark:text-white my-10">
      {categoryDisplayName}
    </h1>
    {images.length === 0 ? (
      <p class="animate">No images found in this category.</p>
    ) : (
      <div class="flex flex-wrap justify-center gap-4 align-items-center">
        {images.map((image) => (
          <div class="flex justify-center flex-row md:w-2/5">
            <figure>
              <Image
                src={image.data.image}
                alt={image.data.title}
                class="max-w-xl w-full h-auto aspect-[4/3] object-cover"
              />
              <figcaption class="text-center">
                <i>{image.data.title}</i>
                {image.data.summary && `, ${image.data.summary}`}
              </figcaption>
            </figure>
          </div>
        ))}
      </div>
    )}
  </Container>
</PageLayout>